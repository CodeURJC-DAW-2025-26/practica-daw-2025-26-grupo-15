<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>DSGram | Solution</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous" />
  <link rel="stylesheet" href="/assets/style.css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
</head>

<body>
  <main class="page">
    <div class="d-flex flex align-items-center justify-content-between">
      <div class="brand">
        <span class="brand-mark"></span>
        <a href="/"><span class="brand-title">DSGram</span></a>
      </div>
      {{#logged}}
      <div class="profile-image d-flex align-items-center gap-2">
        <a href="/profile">
          <div class="avatar avatar--img">
            {{#user.photo}}<img src="/images/{{user.photo.id}}" alt="Profile photo" />{{/user.photo}}
            {{^user.photo}}<span>{{user.nameInitial}}</span>{{/user.photo}}
          </div>
        </a>
      </div>
      {{/logged}}
      {{^logged}}
      <a class="btn ghost" href="/login">Log in</a>
      {{/logged}}
    </div>

    <div class="container">
      <div class="row justify-content-center">
        <div class="col-12 col-lg-10">
          <section class="content-section mb-4">
            <div class="content-section__header">
              <div
                class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center gap-3 mb-3">
                <div>
                  <h2 class="content-section__title mb-2">{{solution.name}}</h2>
                  <p class="content-section__meta text-muted mb-0">
                    By {{solution.owner.name}} Â· For Exercise: {{solution.exercise.title}}
                  </p>
                  <small class="text-secondary">Submitted: {{solution.lastUpdate}}</small>
                </div>
                {{#logged}}
                <div class="card-actions d-flex flex-row align-items-center gap-2">
                  <a href="/solution/{{solution.id}}/export/pdf" class="btn solution-export-btn">
                    <i class="bi bi-file-earmark-pdf"></i>
                    Download PDF
                  </a>
                  {{#isOwner}}
                  <button type="button" class="btn-icon d-flex align-items-center justify-content-center"
                    data-bs-toggle="modal" data-bs-target="#deleteSolutionModal{{solution.id}}">
                    <i class="bi bi-trash"></i>
                  </button>
                  {{/isOwner}}
                </div>
                {{/logged}}
              </div>

              <div class="solution-description mt-3">
                <p class="solution-description__label mb-2">Solution Description</p>
                <p class="solution-description__text mb-0">{{solution.description}}</p>
              </div>
            </div>

            {{#isOwner}}
            <div class="modal fade" id="deleteSolutionModal{{solution.id}}" tabindex="-1"
              aria-labelledby="deleteSolutionModalLabel{{solution.id}}" aria-hidden="true">
              <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content" style="background: var(--bg-card); border: var(--stroke-light);">
                  <div class="modal-header border-0">
                    <h5 class="modal-title" id="deleteSolutionModalLabel{{solution.id}}">Confirm deletion</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"
                      aria-label="Close"></button>
                  </div>
                  <div class="modal-body">
                    <p class="mb-0">Are you sure you want to delete the solution "<strong>{{solution.name}}</strong>"?
                    </p>
                    <p class="text-muted mt-2 mb-0">This action cannot be undone.</p>
                  </div>
                  <div class="modal-footer border-0">
                    <button type="button" class="btn secondary" data-bs-dismiss="modal">Cancel</button>
                    <form method="post" action="/exercise/{{solution.exercise.id}}/solution/{{solution.id}}/delete"
                      style="display: inline;">
                      <input type="hidden" name="_csrf" value="{{token}}" />
                      <button type="submit" class="btn" style="background-color: var(--danger, #dc3545);">Delete
                        solution</button>
                    </form>
                  </div>
                </div>
              </div>
            </div>
            {{/isOwner}}

            {{#solution.solImage}}
            <div class="solution-content mt-4">
              {{#logged}}
              <div class="solution-viewer text-center p-2 bg-dark rounded overflow-hidden">
                <img src="/images/{{solution.solImage.id}}" alt="Solution Visualization"
                  class="img-fluid rounded shadow-sm" style="max-height: 600px; width: auto;">
              </div>
              {{/logged}}
              {{^logged}}
              <div class="solution-viewer solution-viewer--locked">
                <div class="solution-viewer__overlay">
                  <i class="bi bi-lock-fill solution-viewer__lock-icon" aria-hidden="true"></i>
                  <p class="solution-viewer__lock-title">Solution image locked</p>
                  <p class="solution-viewer__lock-sub">Log in to view the full solution image.</p>
                  <a class="btn solution-viewer__login-btn" href="/login">Log in</a>
                </div>
              </div>
              {{/logged}}
            </div>
            {{/solution.solImage}}
          </section>

          <section class="content-section">
            <h3 class="content-section__subtitle mb-4">Comments ({{solution.numComments}})</h3>
            <div class="comment-list mb-4">
              {{#solution.comments}}
              <div class="comment-item">
                <div class="comment-item__header d-flex justify-content-between align-items-center">
                  <div class="d-flex align-items-center gap-2">
                    {{#owner}}
                    {{#photo}}
                    <div class="avatar-sm avatar--img">
                      <img src="/images/{{id}}" alt="avatar"
                        style="width:100%;height:100%;object-fit:cover;border-radius:50%;display:block;" />
                    </div>
                    {{/photo}}
                    {{^photo}}
                    <div class="avatar-sm">{{nameInitial}}</div>
                    {{/photo}}
                    {{/owner}}
                    <div>
                      <strong class="comment-item__author">{{owner.name}}</strong>
                      <span class="comment-item__date">{{lastUpdate}}</span>
                    </div>
                  </div>

                  {{#isOwner}}
                  <button type="button" class="btn-icon" data-bs-toggle="modal"
                    data-bs-target="#deleteCommentModal{{id}}">
                    <i class="bi bi-trash"></i>
                  </button>
                  {{/isOwner}}
                </div>
                <p class="comment-item__text mt-2">{{text}}</p>
              </div>

              {{#isOwner}}
              <div class="modal fade" id="deleteCommentModal{{id}}" tabindex="-1" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered">
                  <div class="modal-content" style="background: var(--bg-card); border: var(--stroke-light);">
                    <div class="modal-header border-0">
                      <h5 class="modal-title">Delete Comment</h5>
                      <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                      <p>Are you sure you want to delete this comment?</p>
                    </div>
                    <div class="modal-footer border-0">
                      <button type="button" class="btn secondary" data-bs-dismiss="modal">Cancel</button>
                      <form method="post" action="/solution/{{solution.id}}/comment/{{id}}/delete">
                        <input type="hidden" name="_csrf" value="{{token}}" />
                        <button type="submit" class="btn"
                          style="background-color: var(--danger, #dc3545);">Delete</button>
                      </form>
                    </div>
                  </div>
                </div>
              </div>
              {{/isOwner}}
              {{/solution.comments}}
              {{^solution.comments}}
              <p class="text-muted">No comments yet. Be the first to help!</p>
              {{/solution.comments}}
            </div>

            {{#logged}}
            <form class="add-comment-form" action="/solution/{{solution.id}}/comment" method="post">
              <div class="row g-3 align-items-end">
                <div class="col-12 col-md-9">
                  <label for="new-comment" class="form-label">Add your comment</label>
                  <input id="new-comment" name="text" class="form-control" type="text"
                    placeholder="Share your thoughts..." required />
                </div>
                <div class="col-12 col-md-3">
                  <button class="btn w-100" type="submit">Comment</button>
                </div>
              </div>
              <input type="hidden" name="_csrf" value="{{token}}">
            </form>
            {{/logged}}
            {{^logged}}
            <div class="text-center">
              <p class="text-muted mb-0">Log in to comment, export PDF or manage this solution.</p>
            </div>
            {{/logged}}

            <div class="text-center mt-5">
              <a class="btn ghost" href="/exercise/{{solution.exercise.id}}">Back to Exercise</a>
            </div>
          </section>
        </div>
      </div>
    </div>
  </main>

  {{>footer}}

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
    crossorigin="anonymous"></script>
</body>

</html>
