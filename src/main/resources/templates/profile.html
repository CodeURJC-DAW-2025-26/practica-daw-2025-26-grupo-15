<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>DSGram | Profile</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous" />
  <link rel="stylesheet" href="/assets/style.css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
</head>

<body>
  <main class="page page--feed">
    <div class="brand brand--full">
      <span class="brand-mark"></span>
      <a href="/"><span class="brand-title">DSGram</span></a>
      {{#isOwnProfile}}
      <form action="/logout" method="post" class="brand-logout">
        <button type="submit" class="btn-logout"><i class="bi bi-box-arrow-right"></i> Log out</button>
        <input type="hidden" name="_csrf" value="{{token}}" />
      </form>
      {{/isOwnProfile}}
    </div>

    <section class="app-shell feed">
      <div class="container-fluid px-0">
        <div class="row g-0">
          <aside class="sidebar col-12 col-lg-3">
            <div class="profile-sidebar-header">
              <div class="profile-avatar-preview">
                {{#user.photo}}
                <img src="/images/{{user.photo.id}}" alt="Profile photo" style="width:100%;height:100%;object-fit:cover;border-radius:50%;display:block;" />
                {{/user.photo}}
                {{^user.photo}}<i class="bi bi-person-circle"></i>{{/user.photo}}
              </div>
            </div>

            <div class="pill">{{user.name}}</div>
            <div class="pill">{{#user.bio}}{{user.bio}}{{/user.bio}}{{^user.bio}}No bio yet.{{/user.bio}}</div>
            <div class="pill">{{#user.specialty}}{{user.specialty}}{{/user.specialty}}{{^user.specialty}}No specialty set.{{/user.specialty}}</div>

            {{#isOwnProfile}}

            <div class="sidebar-requests-section">
              <div class="sidebar-requests-header">
                <span class="sidebar-requests-title">
                  <i class="bi bi-person-plus-fill"></i> Follow Requests
                </span>
                {{#hasPendingRequests}}
                <span class="sidebar-requests-badge">{{pendingCount}}</span>
                {{/hasPendingRequests}}
              </div>

              <div class="list">
                {{#firstTreeRequests}}
                <div class="list-item">
                  <div class="req-identity">
                    <div class="req-avatar">
                      {{#photo}}<img src="/images/{{photo.id}}" alt="{{name}}" />{{/photo}}
                      {{^photo}}<span>{{nameInitial}}</span>{{/photo}}
                    </div>
                    <span class="req-name">{{name}}</span>
                  </div>
                  <div class="actions">
                    <span class="tag tag-accept" title="Accept"><i class="bi bi-check-lg"></i></span>
                    <span class="tag tag-decline" title="Decline"><i class="bi bi-x-lg"></i></span>
                  </div>
                </div>
                {{/firstTreeRequests}}
                {{^firstTreeRequests}}
                <p class="sidebar-requests-empty">No pending requests.</p>
                    {{/firstTreeRequests}}
              </div>
              

              <a class="btn secondary sidebar-requests-see-all" href="/follow-requests">
                <i class="bi bi-arrow-right-short"></i> See all requests
              </a>
            </div>
  
            <a class="btn secondary" href="/follow-requests">See all</a>
            {{/isOwnProfile}}
          </aside>

          <div class="content col-12 col-lg-9">
            <div
              class="topbar d-flex flex-column flex-md-row align-items-start align-items-md-center justify-content-between gap-3">
              <div class="profile-title-block">
                <h2 class="section-title">User's profile</h2>

                <div class="profile-actions d-flex align-items-center flex-nowrap gap-3">
                  <div class="followers-cta">
                    <a class="followers-cta-link" href="/followers">
                      <span class="followers-cta-value">{{followersNumber}}</span>
                      <span class="followers-cta-label">Followers</span>
                    </a>

                    <div class="followers-cta-divider"></div>

                    <a class="followers-cta-link" href="/following">
                      <span class="followers-cta-value">{{followingNumber}}</span>
                      <span class="followers-cta-label">Following</span>
                    </a>
                  </div>

                  <a class="btn plus-btn rounded-circle" href="/new-list">
                    <i class="bi bi-plus"></i>
                  </a>
                </div>
              </div>
              {{#isOwnProfile}}
              <div class="dropdown">
                <div class="avatar avatar--img">
                  {{#user.photo}}
                  <img src="/images/{{user.photo.id}}" alt="Profile photo" />
                  {{/user.photo}}
                  {{^user.photo}}<i class="bi bi-person-circle"></i>{{/user.photo}}
                </div>
                <div class="dropdown-content">
                  <a href="/edit-profile">Edit profile</a>
                </div>
              </div>
              {{/isOwnProfile}}
              {{^isOwnProfile}}
              {{#logged}}
              {{#hasRequested}}
              <button class="btn secondary" type="button" disabled>Requested</button>
                {{/hasRequested}}
                {{^hasRequested}}
              <form method="post" action="/requestToFollow">
                  <input type="hidden" name="requesterId" value="{{loggedUserId}}"/>
                  <input type="hidden" name="targetId" value="{{user.id}}"/>
                  <input type="hidden" name="_csrf" value="{{token}}"/>
                  <button class="btn secondary" type="submit">Follow</button>
                </form>
                {{/hasRequested}}
              {{/logged}}
              {{/isOwnProfile}}
            </div>

            <!--User lists-->
            <div class="feed-stream">
              {{#userLists}}
              <article class="mt-0 feed-card">
              <a href="/list-view/{{id}}" class="list-name">
                <header class="d-flex flex-column flex-md-row align-items-start align-items-md-center justify-content-between gap-0">
                  <div>
                    <h3>{{title}}</h3>
                    <p class="meta">Last update Â· {{lastUpdate}}</p>
                  </div>

                  {{#isOwnProfile}}
                  <div class="card-actions d-flex flex-column align-items-end g-1">
                    <button class="btn-icon btn-icon-edit" type="button">
                      <a href="/edit-list/{{id}}">
                      <i class="bi bi-pencil icon-static"></i>
                      <img src="/assets/pencilanimated.gif" alt="Editar" class="icon-gif">
                      </a>
                    </button>
                    <button type="button" class="btn-icon" data-bs-toggle="modal" data-bs-target="#deleteModal{{id}}">
                      <i class="bi bi-trash"></i>
                    </button>
                  </div>
                  {{/isOwnProfile}}
                  
                </header>
                <p class="muted">{{description}}</p>
              
              </article> 
              <div class="modal fade" id="deleteModal{{id}}" tabindex="-1" aria-labelledby="deleteModalLabel{{id}}" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered">
                  <div class="modal-content" style="background: var(--bg-card); border: var(--stroke-light);">
                    <div class="modal-header border-0">
                      <h5 class="modal-title" id="deleteModalLabel{{id}}">Confirm deletion</h5>
                      <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                      <p class="mb-0">Are you sure you want to delete the list "<strong>{{title}}</strong>"?</p>
                      <p class="text-muted mt-2 mb-0">This action cannot be undone.</p>
                    </div>
                    <div class="modal-footer border-0">
                      <button type="button" class="btn secondary" data-bs-dismiss="modal">Cancel</button>
                      <form method="post" action="/delete/list/{{id}}" style="display: inline;">
                        <input type="hidden" name="_csrf" value="{{token}}"/>
                        <button type="submit" class="btn" style="background-color: var(--danger, #dc3545);">Delete list</button>
                      </form>
                    </div>
                  </div>
                </div>
              </div>
              {{/userLists}}
              {{^userLists}}
              <div class="text-center py-5">
                {{#isOwnProfile}}<p class="muted">You haven't created any lists yet.</p>{{/isOwnProfile}}
                {{^isOwnProfile}}<p class="muted">This user hasn't created any lists yet.</p>{{/isOwnProfile}}
              </div>
              {{/userLists}}           
            </div>
          </div>
        </div>
      </div>
    </section>
  </main>

  {{>footer}}

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
</body>

</html>